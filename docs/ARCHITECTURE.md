# SocioMint 项目架构文档

*文档版本: v1.0.0 - 2025年5月*

## 1. 系统概述

SocioMint是一个基于区块链的社交任务平台，通过代币化激励机制连接品牌与社交用户。系统采用链上/链下混合架构，核心资产和权限管理部署在区块链上，而任务系统和用户交互逻辑主要在链下实现。

## 2. 系统架构

### 2.1 整体架构

系统由以下几个主要组件构成:

```
+---------------------------+        +---------------------------+
|       链上组件             |        |         链下组件           |
|                           |        |                           |
|  +-------------------+    |        |  +-------------------+    |
|  |      SMToken      |    |        |  |   任务管理系统     |    |
|  +-------------------+    |        |  +-------------------+    |
|                           |        |                           |
|  +-------------------+    |        |  +-------------------+    |
|  |    CoreSystem     |◄───┼────────┼─►|  社交平台集成     |    |
|  +-------------------+    |        |  +-------------------+    |
|                           |        |                           |
|  +-------------------+    |        |  +-------------------+    |
|  |   TeamUnlockerV2  |    |        |  |   宝箱与奖励系统   |    |
|  +-------------------+    |        |  +-------------------+    |
|                           |        |                           |
|  +-------------------+    |        |  +-------------------+    |
|  |  MerchantManager  |◄───┼────────┼─►|   商户管理面板    |    |
|  +-------------------+    |        |  +-------------------+    |
|                           |        |                           |
+---------------------------+        +---------------------------+
            ▲                                      ▲
            │                                      │
            │                                      │
            ▼                                      ▼
+---------------------------+        +---------------------------+
|                           |        |                           |
|       前端应用            |◄───────►|       后端API服务        |
|                           |        |                           |
+---------------------------+        +---------------------------+
```

### 2.2 链上组件

#### 2.2.1 核心智能合约

1. **SMToken.sol** - 平台代币合约
   - ERC20代币标准实现
   - 可升级设计 (UUPS模式)
   - 角色权限控制

2. **CoreSystem.sol** - 核心系统合约
   - 钱库功能：资金锁定与释放
   - 质押机制：流动性管理
   - 与其他合约的交互逻辑

3. **TeamUnlockerV2.sol** - 团队代币解锁合约
   - 团队代币分配与解锁逻辑
   - KPI条件验证功能
   - 紧急情况处理机制
   - 多重确认安全机制

4. **MerchantManager.sol** - 商户管理合约
   - 商户注册与认证
   - 商户权限管理
   - 商户特权功能

### 2.3 链下组件

#### 2.3.1 数据库设计 (Supabase)

1. **用户系统**
   - users: 用户基本信息
   - social_accounts: 用户绑定的社交账号
   - wallet_info: 用户钱包信息

2. **任务系统**
   - tasks: 任务基本信息
   - task_participants: 任务参与者
   - task_submissions: 任务提交内容
   - task_disputes: 任务争议记录
   - task_payments: 任务支付记录

3. **宝箱系统**
   - treasure_boxes: 宝箱配置
   - box_tiers: 宝箱等级设置
   - box_rewards: 宝箱奖励配置
   - box_claims: 用户宝箱领取记录

4. **商户系统**
   - merchants: 商户基本信息
   - merchant_applications: 商户申请记录
   - merchant_transactions: 商户交易记录

#### 2.3.2 后端服务

1. **API服务** - Node.js + Express
   - 用户认证与授权
   - 任务管理API
   - 社交平台集成
   - 区块链交互

2. **任务处理服务** - 独立微服务
   - 任务验证逻辑
   - 奖励计算引擎
   - 争议解决流程

3. **社交平台集成** - OAuth服务
   - Twitter集成
   - Discord集成
   - 社交身份验证

4. **区块链监听服务** - Web3事件监听
   - 合约事件监听
   - 交易确认处理
   - 链上数据同步

### 2.4 前端应用

1. **核心架构** - Next.js + React
   - SSR渲染
   - 组件化设计
   - 响应式布局

2. **页面结构**
   - 首页/发现页
   - 任务广场
   - 用户中心
   - 商户中心
   - 钱包管理
   - 宝箱系统

3. **核心组件**
   - 钱包连接组件
   - 任务卡片组件
   - 宝箱开启组件
   - 社交账号绑定组件

## 3. 关键流程设计

### 3.1 用户注册与认证流程

1. 用户通过钱包连接应用
2. 系统生成用户基础档案
3. 用户绑定社交账号（Twitter/Discord）
4. 绑定后获得基础功能访问权限

### 3.2 任务创建与参与流程

**创建流程**:
1. 商户发起任务创建请求
2. 设置任务参数（预算、时长、条件）
3. 审核后任务上线

**参与流程**:
1. 用户浏览并选择任务
2. 提交任务完成证明
3. 系统自动/人工验证
4. 任务完成后奖励发放

### 3.3 宝箱开启流程

1. 用户获得开箱资格（完成任务/活动）
2. 用户在前端触发开箱
3. 后端计算随机奖励
4. 记录开箱结果并展示
5. 奖励发放至用户账户

### 3.4 商户管理流程

1. 商户提交注册申请
2. 后台审核商户资质
3. 符合条件的商户质押SM代币
4. 获得商户权限与特权
5. 可发布任务和活动

## 4. 安全设计

### 4.1 合约安全机制

1. **多重验证** - 关键操作需要多重确认
2. **紧急暂停** - 系统异常时可暂停操作
3. **时间锁定** - 敏感操作带有执行延迟
4. **权限分离** - 管理权限与执行权限分离
5. **事件记录** - 所有关键操作记录事件

### 4.2 应用安全措施

1. **签名验证** - 使用钱包签名验证身份
2. **API安全** - JWT认证和请求限流
3. **数据加密** - 敏感数据加密存储
4. **授权控制** - 精细的权限控制体系

## 5. 部署架构

```
+------------------+        +------------------+
|   负载均衡器      |◄───────►|   CDN网络       |
+------------------+        +------------------+
        ▲
        │
        ▼
+---------------------------+
|      Web服务器集群        |
+---------------------------+
        ▲
        │
        ▼
+------------------+        +------------------+
|   API服务集群    |◄───────►|   缓存服务       |
+------------------+        +------------------+
        ▲
        │
        ▼
+------------------+        +------------------+
|   数据库集群     |        |   区块链节点     |
+------------------+        +------------------+
```

## 6. 开发与部署流程

### 6.1 开发流程

1. 本地开发环境设置
2. 代码审查与测试
3. 持续集成与部署
4. 合约升级与维护

### 6.2 部署流程

1. 测试网部署与验证
2. 主网部署准备
3. 合约部署与初始化
4. 前后端应用部署

## 7. 未来演进方向

1. **治理系统集成** - 引入DAO治理机制
2. **跨链资产支持** - 扩展到多链生态
3. **AI辅助任务验证** - 智能化任务完成验证
4. **NFT系统整合** - 用户成就和特权NFT化

## 8. 附录

### 8.1 技术栈总览

- **前端**: Next.js, React, Typescript, TailwindCSS
- **后端**: Node.js, Express, Supabase, PostgreSQL
- **区块链**: Solidity, Hardhat, Ethers.js, OpenZeppelin
- **部署**: Docker, Kubernetes, AWS/Google Cloud

### 8.2 关键依赖版本

- Node.js: v16.14+
- Solidity: 0.8.19
- OpenZeppelin: 4.9.3
- Hardhat: 2.17.0
- Next.js: 13.4.7 