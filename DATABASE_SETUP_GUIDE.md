# SocioMint æ•°æ®åº“è®¾ç½®æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨è®¾ç½® SocioMint é¡¹ç›®çš„ Supabase æ•°æ®åº“ã€‚ç”±äº Supabase çš„å®‰å…¨é™åˆ¶ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œ SQL è„šæœ¬ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

1. âœ… Supabase é¡¹ç›®å·²åˆ›å»º
2. âœ… ç¯å¢ƒå˜é‡å·²é…ç½®
3. âœ… å…·æœ‰ Supabase é¡¹ç›®çš„ç®¡ç†å‘˜æƒé™

## ğŸš€ è®¾ç½®æ­¥éª¤

### æ­¥éª¤ 1: è®¿é—® Supabase Dashboard

1. æ‰“å¼€ [Supabase Dashboard](https://app.supabase.com)
2. é€‰æ‹©æ‚¨çš„é¡¹ç›®: `kiyyhitozmezuppziomx`
3. ç‚¹å‡»å·¦ä¾§èœå•çš„ "SQL Editor"

### æ­¥éª¤ 2: æ‰§è¡Œæ•°æ®åº“è¿ç§»

æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œ SQL æ–‡ä»¶ï¼š

#### 2.1 æ ¸å¿ƒè¡¨ç»“æ„
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ supabase/migrations/001_core_tables.sql çš„å†…å®¹
```

#### 2.2 è¡Œçº§å®‰å…¨ç­–ç•¥
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ supabase/migrations/002_rls_policies.sql çš„å†…å®¹
```

#### 2.3 å‡½æ•°å’Œè§¦å‘å™¨
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ supabase/migrations/003_functions_triggers.sql çš„å†…å®¹
```

#### 2.4 è§†å›¾å’Œç´¢å¼•
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ supabase/migrations/004_views_indexes.sql çš„å†…å®¹
```

### æ­¥éª¤ 3: æ’å…¥ç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æµ‹è¯•æ•°æ®ï¼š

```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ supabase/seed.sql çš„å†…å®¹
```

## ğŸ“Š éªŒè¯è®¾ç½®

æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢éªŒè¯æ•°æ®åº“è®¾ç½®ï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_type = 'BASE TABLE';

-- æ£€æŸ¥è§†å›¾æ˜¯å¦åˆ›å»ºæˆåŠŸ
SELECT table_name 
FROM information_schema.views 
WHERE table_schema = 'public';

-- æ£€æŸ¥å‡½æ•°æ˜¯å¦åˆ›å»ºæˆåŠŸ
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_schema = 'public' 
AND routine_type = 'FUNCTION';

-- æ£€æŸ¥ç§å­æ•°æ®
SELECT COUNT(*) as user_count FROM user_profiles;
SELECT COUNT(*) as task_count FROM social_tasks;
SELECT COUNT(*) as merchant_count FROM merchants;
```

## ğŸ”§ è‡ªåŠ¨åŒ–è„šæœ¬

è™½ç„¶ä¸èƒ½è‡ªåŠ¨æ‰§è¡Œ SQLï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ¥æ˜¾ç¤ºéœ€è¦æ‰§è¡Œçš„ SQLï¼š

```bash
# æ˜¾ç¤ºæ‰€æœ‰è¿ç§» SQL
npm run db:deploy

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
npm run db:status
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
supabase/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 001_core_tables.sql      # æ ¸å¿ƒè¡¨ç»“æ„
â”‚   â”œâ”€â”€ 002_rls_policies.sql     # è¡Œçº§å®‰å…¨ç­–ç•¥
â”‚   â”œâ”€â”€ 003_functions_triggers.sql # å‡½æ•°å’Œè§¦å‘å™¨
â”‚   â””â”€â”€ 004_views_indexes.sql    # è§†å›¾å’Œç´¢å¼•
â”œâ”€â”€ seed.sql                     # ç§å­æ•°æ®
â””â”€â”€ config.toml                  # Supabase é…ç½®
```

## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **RLS ç­–ç•¥**: æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº†è¡Œçº§å®‰å…¨ç­–ç•¥
2. **ç”¨æˆ·æƒé™**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
3. **æœåŠ¡è§’è‰²**: åç«¯æœåŠ¡ä½¿ç”¨ service_role å¯†é’¥
4. **API å¯†é’¥**: å‰ç«¯ä½¿ç”¨ anon å¯†é’¥

## ğŸ” å¸¸è§é—®é¢˜

### Q: æ‰§è¡Œ SQL æ—¶å‡ºç°æƒé™é”™è¯¯ï¼Ÿ
A: ç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯é¡¹ç›®æ‰€æœ‰è€…è´¦å·ï¼Œå¹¶ä¸”åœ¨æ­£ç¡®çš„é¡¹ç›®ä¸­æ‰§è¡Œã€‚

### Q: è¡¨å·²å­˜åœ¨é”™è¯¯ï¼Ÿ
A: ä½¿ç”¨ `DROP TABLE IF EXISTS` æˆ–æ£€æŸ¥è¡¨æ˜¯å¦å·²ç»åˆ›å»ºã€‚

### Q: å‡½æ•°åˆ›å»ºå¤±è´¥ï¼Ÿ
A: æ£€æŸ¥ PostgreSQL ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œç¡®ä¿è¯­æ³•æ­£ç¡®ã€‚

### Q: RLS ç­–ç•¥ä¸ç”Ÿæ•ˆï¼Ÿ
A: ç¡®ä¿è¡¨å·²å¯ç”¨ RLSï¼š`ALTER TABLE table_name ENABLE ROW LEVEL SECURITY;`

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥ Supabase Dashboard çš„æ—¥å¿—
2. æŸ¥çœ‹ SQL ç¼–è¾‘å™¨çš„é”™è¯¯ä¿¡æ¯
3. å‚è€ƒ [Supabase æ–‡æ¡£](https://supabase.com/docs)
4. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æ ¸å¿ƒè¡¨åˆ›å»ºå®Œæˆ
- [ ] RLS ç­–ç•¥è®¾ç½®å®Œæˆ
- [ ] å‡½æ•°å’Œè§¦å‘å™¨åˆ›å»ºå®Œæˆ
- [ ] è§†å›¾å’Œç´¢å¼•åˆ›å»ºå®Œæˆ
- [ ] ç§å­æ•°æ®æ’å…¥å®Œæˆï¼ˆå¯é€‰ï¼‰
- [ ] éªŒè¯æŸ¥è¯¢æ‰§è¡ŒæˆåŠŸ
- [ ] åº”ç”¨å¯ä»¥è¿æ¥æ•°æ®åº“
- [ ] ç”¨æˆ·æ³¨å†Œå’Œç™»å½•åŠŸèƒ½æ­£å¸¸

## ğŸ‰ ä¸‹ä¸€æ­¥

æ•°æ®åº“è®¾ç½®å®Œæˆåï¼š

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`
2. è¿è¡Œæµ‹è¯•ï¼š`npm test`
3. æ£€æŸ¥ API é›†æˆï¼š`npm run test:integration`
4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**æ³¨æ„**: è¿™æ˜¯ä¸€æ¬¡æ€§è®¾ç½®è¿‡ç¨‹ã€‚ä¸€æ—¦æ•°æ®åº“ç»“æ„å»ºç«‹ï¼Œåç»­çš„æ›´æ”¹å¯ä»¥é€šè¿‡è¿ç§»è„šæœ¬ç®¡ç†ã€‚
