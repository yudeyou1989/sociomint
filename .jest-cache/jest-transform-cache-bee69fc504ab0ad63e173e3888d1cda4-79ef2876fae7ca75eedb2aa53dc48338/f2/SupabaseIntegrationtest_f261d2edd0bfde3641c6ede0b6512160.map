{"version":3,"sources":["/Users/yudeyou/Desktop/sm/sociomint/src/__tests__/integration/SupabaseIntegration.test.ts"],"sourcesContent":["/**\n * Supabase 集成测试\n * 测试与 Supabase 数据库和 API 的集成\n */\n\nimport { createClient } from '@supabase/supabase-js';\n\n// 创建一个可链式调用的Mock查询构建器\nconst createMockQueryBuilder = () => {\n  const mockQueryBuilder: any = {\n    select: jest.fn(),\n    insert: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    eq: jest.fn(),\n    neq: jest.fn(),\n    gt: jest.fn(),\n    lt: jest.fn(),\n    gte: jest.fn(),\n    lte: jest.fn(),\n    like: jest.fn(),\n    ilike: jest.fn(),\n    in: jest.fn(),\n    order: jest.fn(),\n    limit: jest.fn(),\n    range: jest.fn(),\n    single: jest.fn().mockResolvedValue({ data: null, error: null }),\n    maybeSingle: jest.fn().mockResolvedValue({ data: null, error: null }),\n  };\n\n  // 设置链式调用\n  Object.keys(mockQueryBuilder).forEach(key => {\n    if (!['single', 'maybeSingle'].includes(key)) {\n      mockQueryBuilder[key].mockReturnValue(mockQueryBuilder);\n    }\n  });\n\n  return mockQueryBuilder;\n};\n\nconst mockQueryBuilder = createMockQueryBuilder();\n\n// 模拟 Supabase 客户端\nconst mockSupabaseClient = {\n  from: jest.fn().mockImplementation(() => createMockQueryBuilder()),\n  auth: {\n    signUp: jest.fn(),\n    signIn: jest.fn(),\n    signOut: jest.fn(),\n    getUser: jest.fn(),\n    onAuthStateChange: jest.fn(),\n  },\n  storage: {\n    from: jest.fn(),\n  },\n  rpc: jest.fn(),\n};\n\n// 模拟 createClient\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(() => mockSupabaseClient),\n}));\n\ndescribe('Supabase Integration Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockSupabaseClient.from.mockReturnValue(mockQueryBuilder);\n  });\n\n  describe('Database Operations', () => {\n    describe('User Management', () => {\n      it('should create a new user profile', async () => {\n        const userData = {\n          id: 'user-123',\n          wallet_address: '0x1234567890abcdef1234567890abcdef12345678',\n          username: 'testuser',\n          email: 'test@example.com',\n          created_at: new Date().toISOString(),\n        };\n\n        mockQueryBuilder.insert.mockResolvedValue({\n          data: userData,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('user_profiles')\n          .insert(userData);\n\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('user_profiles');\n        expect(mockQueryBuilder.insert).toHaveBeenCalledWith(userData);\n        expect(result.data).toEqual(userData);\n        expect(result.error).toBeNull();\n      });\n\n      it('should fetch user profile by wallet address', async () => {\n        const walletAddress = '0x1234567890abcdef1234567890abcdef12345678';\n        const userData = {\n          id: 'user-123',\n          wallet_address: walletAddress,\n          username: 'testuser',\n          sm_balance: '1000.0',\n        };\n\n        mockQueryBuilder.single.mockResolvedValue({\n          data: userData,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('user_profiles')\n          .select('*')\n          .eq('wallet_address', walletAddress)\n          .single();\n\n        expect(mockQueryBuilder.select).toHaveBeenCalledWith('*');\n        expect(mockQueryBuilder.eq).toHaveBeenCalledWith('wallet_address', walletAddress);\n        expect(mockQueryBuilder.single).toHaveBeenCalled();\n        expect(result.data).toEqual(userData);\n      });\n\n      it('should update user balance', async () => {\n        const userId = 'user-123';\n        const newBalance = '1500.0';\n\n        mockQueryBuilder.update.mockResolvedValue({\n          data: { id: userId, sm_balance: newBalance },\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('user_profiles')\n          .update({ sm_balance: newBalance })\n          .eq('id', userId);\n\n        expect(mockQueryBuilder.update).toHaveBeenCalledWith({ sm_balance: newBalance });\n        expect(mockQueryBuilder.eq).toHaveBeenCalledWith('id', userId);\n      });\n    });\n\n    describe('Transaction History', () => {\n      it('should record a new transaction', async () => {\n        const transactionData = {\n          id: 'tx-123',\n          user_id: 'user-123',\n          type: 'exchange',\n          amount_bnb: '0.1',\n          amount_sm: '120.48',\n          tx_hash: '0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890',\n          status: 'completed',\n          created_at: new Date().toISOString(),\n        };\n\n        mockQueryBuilder.insert.mockResolvedValue({\n          data: transactionData,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('transactions')\n          .insert(transactionData);\n\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('transactions');\n        expect(mockQueryBuilder.insert).toHaveBeenCalledWith(transactionData);\n        expect(result.data).toEqual(transactionData);\n      });\n\n      it('should fetch user transaction history', async () => {\n        const userId = 'user-123';\n        const transactions = [\n          {\n            id: 'tx-1',\n            type: 'exchange',\n            amount_bnb: '0.1',\n            amount_sm: '120.48',\n            status: 'completed',\n            created_at: '2024-01-01T00:00:00Z',\n          },\n          {\n            id: 'tx-2',\n            type: 'exchange',\n            amount_bnb: '0.05',\n            amount_sm: '60.24',\n            status: 'completed',\n            created_at: '2024-01-02T00:00:00Z',\n          },\n        ];\n\n        mockQueryBuilder.select.mockResolvedValue({\n          data: transactions,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('transactions')\n          .select('*')\n          .eq('user_id', userId)\n          .order('created_at', { ascending: false })\n          .limit(10);\n\n        expect(mockQueryBuilder.eq).toHaveBeenCalledWith('user_id', userId);\n        expect(mockQueryBuilder.order).toHaveBeenCalledWith('created_at', { ascending: false });\n        expect(mockQueryBuilder.limit).toHaveBeenCalledWith(10);\n        expect(result.data).toEqual(transactions);\n      });\n\n      it('should update transaction status', async () => {\n        const txId = 'tx-123';\n        const newStatus = 'failed';\n\n        mockQueryBuilder.update.mockResolvedValue({\n          data: { id: txId, status: newStatus },\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('transactions')\n          .update({ status: newStatus })\n          .eq('id', txId);\n\n        expect(mockQueryBuilder.update).toHaveBeenCalledWith({ status: newStatus });\n        expect(mockQueryBuilder.eq).toHaveBeenCalledWith('id', txId);\n      });\n    });\n\n    describe('Social Tasks', () => {\n      it('should create a new social task', async () => {\n        const taskData = {\n          id: 'task-123',\n          title: 'Follow on Twitter',\n          description: 'Follow our official Twitter account',\n          reward_amount: '10.0',\n          task_type: 'social_follow',\n          platform: 'twitter',\n          target_url: 'https://twitter.com/sociomint',\n          is_active: true,\n          created_at: new Date().toISOString(),\n        };\n\n        mockQueryBuilder.insert.mockResolvedValue({\n          data: taskData,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('social_tasks')\n          .insert(taskData);\n\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('social_tasks');\n        expect(mockQueryBuilder.insert).toHaveBeenCalledWith(taskData);\n        expect(result.data).toEqual(taskData);\n      });\n\n      it('should fetch active social tasks', async () => {\n        const activeTasks = [\n          {\n            id: 'task-1',\n            title: 'Follow on Twitter',\n            reward_amount: '10.0',\n            task_type: 'social_follow',\n            is_active: true,\n          },\n          {\n            id: 'task-2',\n            title: 'Join Telegram',\n            reward_amount: '15.0',\n            task_type: 'social_join',\n            is_active: true,\n          },\n        ];\n\n        mockQueryBuilder.select.mockResolvedValue({\n          data: activeTasks,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('social_tasks')\n          .select('*')\n          .eq('is_active', true)\n          .order('created_at', { ascending: false });\n\n        expect(mockQueryBuilder.eq).toHaveBeenCalledWith('is_active', true);\n        expect(mockQueryBuilder.order).toHaveBeenCalledWith('created_at', { ascending: false });\n        expect(result.data).toEqual(activeTasks);\n      });\n\n      it('should record task completion', async () => {\n        const completionData = {\n          id: 'completion-123',\n          user_id: 'user-123',\n          task_id: 'task-123',\n          status: 'completed',\n          verification_data: { twitter_username: '@testuser' },\n          completed_at: new Date().toISOString(),\n        };\n\n        mockQueryBuilder.insert.mockResolvedValue({\n          data: completionData,\n          error: null,\n        });\n\n        const result = await mockSupabaseClient\n          .from('task_completions')\n          .insert(completionData);\n\n        expect(mockSupabaseClient.from).toHaveBeenCalledWith('task_completions');\n        expect(mockQueryBuilder.insert).toHaveBeenCalledWith(completionData);\n        expect(result.data).toEqual(completionData);\n      });\n    });\n  });\n\n  describe('Authentication', () => {\n    it('should sign up a new user', async () => {\n      const email = 'test@example.com';\n      const password = 'password123';\n      const userData = {\n        id: 'user-123',\n        email,\n        email_confirmed_at: new Date().toISOString(),\n      };\n\n      mockSupabaseClient.auth.signUp.mockResolvedValue({\n        data: { user: userData, session: null },\n        error: null,\n      });\n\n      const result = await mockSupabaseClient.auth.signUp({\n        email,\n        password,\n      });\n\n      expect(mockSupabaseClient.auth.signUp).toHaveBeenCalledWith({\n        email,\n        password,\n      });\n      expect(result.data.user).toEqual(userData);\n      expect(result.error).toBeNull();\n    });\n\n    it('should sign in an existing user', async () => {\n      const email = 'test@example.com';\n      const password = 'password123';\n      const sessionData = {\n        access_token: 'access-token-123',\n        refresh_token: 'refresh-token-123',\n        user: { id: 'user-123', email },\n      };\n\n      mockSupabaseClient.auth.signIn.mockResolvedValue({\n        data: { session: sessionData },\n        error: null,\n      });\n\n      const result = await mockSupabaseClient.auth.signIn({\n        email,\n        password,\n      });\n\n      expect(mockSupabaseClient.auth.signIn).toHaveBeenCalledWith({\n        email,\n        password,\n      });\n      expect(result.data.session).toEqual(sessionData);\n    });\n\n    it('should get current user', async () => {\n      const userData = {\n        id: 'user-123',\n        email: 'test@example.com',\n        aud: 'authenticated',\n      };\n\n      mockSupabaseClient.auth.getUser.mockResolvedValue({\n        data: { user: userData },\n        error: null,\n      });\n\n      const result = await mockSupabaseClient.auth.getUser();\n\n      expect(mockSupabaseClient.auth.getUser).toHaveBeenCalled();\n      expect(result.data.user).toEqual(userData);\n    });\n\n    it('should sign out user', async () => {\n      mockSupabaseClient.auth.signOut.mockResolvedValue({\n        error: null,\n      });\n\n      const result = await mockSupabaseClient.auth.signOut();\n\n      expect(mockSupabaseClient.auth.signOut).toHaveBeenCalled();\n      expect(result.error).toBeNull();\n    });\n  });\n\n  describe('Real-time Subscriptions', () => {\n    it('should set up auth state change listener', () => {\n      const callback = jest.fn();\n\n      mockSupabaseClient.auth.onAuthStateChange.mockReturnValue({\n        data: { subscription: { id: 'sub-123' } },\n      });\n\n      const subscription = mockSupabaseClient.auth.onAuthStateChange(callback);\n\n      expect(mockSupabaseClient.auth.onAuthStateChange).toHaveBeenCalledWith(callback);\n      expect(subscription.data.subscription.id).toBe('sub-123');\n    });\n  });\n\n  describe('Error Handling', () => {\n    it('should handle database connection errors', async () => {\n      const error = new Error('Connection failed');\n      mockQueryBuilder.select.mockRejectedValue(error);\n\n      try {\n        await mockSupabaseClient\n          .from('user_profiles')\n          .select('*');\n      } catch (e) {\n        expect(e).toEqual(error);\n      }\n\n      expect(mockQueryBuilder.select).toHaveBeenCalled();\n    });\n\n    it('should handle authentication errors', async () => {\n      const authError = {\n        message: 'Invalid credentials',\n        status: 400,\n      };\n\n      mockSupabaseClient.auth.signIn.mockResolvedValue({\n        data: { session: null },\n        error: authError,\n      });\n\n      const result = await mockSupabaseClient.auth.signIn({\n        email: 'wrong@example.com',\n        password: 'wrongpassword',\n      });\n\n      expect(result.error).toEqual(authError);\n      expect(result.data.session).toBeNull();\n    });\n\n    it('should handle API rate limiting', async () => {\n      const rateLimitError = {\n        message: 'Too many requests',\n        status: 429,\n      };\n\n      mockQueryBuilder.select.mockResolvedValue({\n        data: null,\n        error: rateLimitError,\n      });\n\n      const result = await mockSupabaseClient\n        .from('user_profiles')\n        .select('*');\n\n      expect(result.error).toEqual(rateLimitError);\n      expect(result.data).toBeNull();\n    });\n  });\n\n  describe('Performance Tests', () => {\n    it('should handle large data queries efficiently', async () => {\n      const largeDataSet = Array.from({ length: 1000 }, (_, i) => ({\n        id: `item-${i}`,\n        data: `data-${i}`,\n      }));\n\n      mockQueryBuilder.select.mockResolvedValue({\n        data: largeDataSet,\n        error: null,\n      });\n\n      const startTime = performance.now();\n      \n      const result = await mockSupabaseClient\n        .from('large_table')\n        .select('*')\n        .limit(1000);\n\n      const endTime = performance.now();\n      const queryTime = endTime - startTime;\n\n      expect(queryTime).toBeLessThan(1000); // 应该在1秒内完成\n      expect(result.data).toHaveLength(1000);\n    });\n\n    it('should handle concurrent requests', async () => {\n      mockQueryBuilder.select.mockResolvedValue({\n        data: [{ id: 1, name: 'test' }],\n        error: null,\n      });\n\n      const promises = Array.from({ length: 10 }, () =>\n        mockSupabaseClient\n          .from('test_table')\n          .select('*')\n      );\n\n      const results = await Promise.all(promises);\n\n      expect(results).toHaveLength(10);\n      results.forEach(result => {\n        expect(result.data).toEqual([{ id: 1, name: 'test' }]);\n        expect(result.error).toBeNull();\n      });\n    });\n  });\n});\n"],"names":["jest","mock","createClient","fn","mockSupabaseClient","createMockQueryBuilder","mockQueryBuilder","select","insert","update","delete","eq","neq","gt","lt","gte","lte","like","ilike","in","order","limit","range","single","mockResolvedValue","data","error","maybeSingle","Object","keys","forEach","key","includes","mockReturnValue","from","mockImplementation","auth","signUp","signIn","signOut","getUser","onAuthStateChange","storage","rpc","describe","beforeEach","clearAllMocks","it","userData","id","wallet_address","username","email","created_at","Date","toISOString","result","expect","toHaveBeenCalledWith","toEqual","toBeNull","walletAddress","sm_balance","toHaveBeenCalled","userId","newBalance","transactionData","user_id","type","amount_bnb","amount_sm","tx_hash","status","transactions","ascending","txId","newStatus","taskData","title","description","reward_amount","task_type","platform","target_url","is_active","activeTasks","completionData","task_id","verification_data","twitter_username","completed_at","password","email_confirmed_at","user","session","sessionData","access_token","refresh_token","aud","callback","subscription","toBe","Error","mockRejectedValue","e","authError","message","rateLimitError","largeDataSet","Array","length","_","i","startTime","performance","now","endTime","queryTime","toBeLessThan","toHaveLength","name","promises","results","Promise","all"],"mappings":"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"}