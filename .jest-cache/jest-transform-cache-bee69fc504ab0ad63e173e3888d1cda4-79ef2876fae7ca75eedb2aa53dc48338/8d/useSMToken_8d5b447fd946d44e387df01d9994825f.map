{"version":3,"names":["cov_n04x43rcn","actualCoverage","s","useSMToken","f","address","isConnected","_wagmi","useAccount","balanceData","setBalanceData","_react","useState","undefined","decimals","setDecimals","isLoading","setIsLoading","error","setError","formattedBalance","setFormattedBalance","data","tokenDecimals","useReadContract","_contracts","contractAddresses","smToken","abi","contractAbis","functionName","enabled","tokenBalance","refetch","refetchBalance","args","b","useEffect","Number","formatted","_viem","formatUnits","balance"],"sources":["/Users/yudeyou/Desktop/sm/sociomint/src/hooks/useSMToken.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { formatUnits } from 'viem';\nimport { useAccount, useReadContract } from 'wagmi';\nimport { contractAbis, contractAddresses } from '../config/contracts';\n\nexport function useSMToken() {\n  const { address, isConnected } = useAccount();\n  const [balanceData, setBalanceData] = useState<bigint | undefined>(undefined);\n  const [decimals, setDecimals] = useState<number>(18); // 默认小数位数为18\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const [formattedBalance, setFormattedBalance] = useState('0');\n\n  // 使用 wagmi 的 useReadContract 钩子读取代币小数位数\n  const { data: tokenDecimals } = useReadContract({\n    address: contractAddresses.smToken,\n    abi: contractAbis.smToken,\n    functionName: 'decimals',\n    enabled: isConnected,\n  });\n\n  // 使用 wagmi 的 useReadContract 钩子读取代币余额\n  const { data: tokenBalance, refetch: refetchBalance } = useReadContract({\n    address: contractAddresses.smToken,\n    abi: contractAbis.smToken,\n    functionName: 'balanceOf',\n    args: [address],\n    enabled: isConnected && !!address,\n  });\n\n  // 当获取到小数位数时更新状态\n  useEffect(() => {\n    if (tokenDecimals !== undefined) {\n      setDecimals(Number(tokenDecimals));\n    }\n  }, [tokenDecimals]);\n\n  // 当获取到余额时更新状态\n  useEffect(() => {\n    if (tokenBalance !== undefined) {\n      setBalanceData(tokenBalance);\n      \n      // 格式化余额\n      if (decimals !== undefined) {\n        const formatted = formatUnits(tokenBalance, decimals);\n        setFormattedBalance(formatted);\n      }\n    }\n  }, [tokenBalance, decimals]);\n\n  // 手动刷新功能\n  const refetch = () => {\n    refetchBalance();\n  };\n\n  return {\n    balance: balanceData,\n    formattedBalance,\n    isLoading,\n    error,\n    refetch,\n  };\n}\n"],"mappings":"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","ignoreList":[]}